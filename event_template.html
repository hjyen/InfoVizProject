<!DOCTYPE html>
<html lang="en">
<head>
	<title>InfoViz Earthquake Template</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

	<link rel="stylesheet" href="css/template.css">
	<script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>
    <script src="datamaps.world.min.js"></script>
    <script src="datamaps2.world.min.js"></script>
    <link rel="stylesheet" type="text/css" href="bigearthquake.css">
	<!-- <link rel="stylesheet" type="text/css" href="index.css"> -->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<!-- <link rel="stylesheet" type="text/css" href="index.css"> -->
<style>
    #container1 { border:0px ; width: 800px; height: 400px;margin:0 auto; }
</style>
</head>
<body>
	<h1 class="text-center">SI 649: Info Visualization Group Project</h1></br>
	<div class="tab">
		<button class="tablinks" >Overview</button>
		<button class="tablinks" >Plate Map</button>
		<button class="tablinks" >Depth 101</button>
		<button class="tablinks" >Magnitude</button>
		<button class="tablinks" >Magnitude Simulator</button>
		<button class="tablinks" >Events</button>
	</div>
	</br>
	<div class="container">
		<div class="row">
			<div class="col-sm-9" style="width: 75%">
				<h3>Explore three of the most severe earthquakes.</h3>
				<!-- Replace the img tag to div or any other kind of tags -->
                <div class="row" style="width: 100%;">
                    <div class="col-sm-12">
                        <div id="container1"></div>
                    </div>
                </div>
			</div>
			<div class="col-sm-3" style="width: 25%"> 
				<h3>Japan, March 11, 2011</h3>
				<!-- Replace the img tag to div or any other kind of tags -->
				<img src="img/japan.jpg" class="img-responsive" style="width:100%" alt="Image">
				<p>
					March 11, 2011 - At 2:46 p.m., a 9.1 magnitude earthquake takes place 231 miles northeast of Tokyo at a depth of 15.2 miles.
					The earthquake causes a tsunami with 30-foot waves that damage several nuclear reactors in the area.
					It is the largest earthquake ever to hit Japan.
					</br>
				</p>
				<p class="thick">
					Number of people killed and missing:
				</p>
				<p>
					(Source: Japan's Fire and Disaster Management Agency)
					The combined total of confirmed deaths and missing is more than 22,000 (nearly 20,000 deaths and 2,500 missing). Deaths were caused by the initial earthquake and tsunami and by post-disaster health conditions.
					</br>
				</p>
				<p class="thick">
					Other Facts:
				</p>
				<p>
					
					At the time of the earthquake, Japan had 54 nuclear reactors, with two under construction, and 17 power plants, that produced about 30% of Japan's electricity (IAEA 2011).
					Material damage from the earthquake and tsunami is estimated at about 25 trillion yen ($300 billion).
					There are six reactors at Tokyo Electric Power Company's Fukushima Daiichi plant, located about 65 km (40 miles) south of Sendai.
					A microsievert (mSv) is an internationally recognized unit measuring radiation dosage. People are typically exposed to a total of about 1,000 microsieverts in one year.
					The Japanese government estimated that the tsunami swept about five million tons of debris offshore, but that 70% sank, leaving 1.5 million tons floating in the Pacific Ocean. The debris was not considered to be radioactive.
				</p>
			</div>
		</div>
	</div><br>
	<script>
    queue()
        .defer(d3.csv, "database.csv")
        .await(ready);
    var check = 1; //check if the map has already been created. 
    var bombMap;

    function ready(error, data) {
        var eqdata = data;
        var yearPlot = "2016";
        // var yearPlot = document.getElementById("range").innerHTML;
        // console.log(yearPlot); //get this value from slider

        //radius scale and color scale
        var rScale = d3.scale.linear()
            .domain([5, 9])
            .range([2, 40]);

        //get year of 1965, store index to yearIndex
        var yearIndex = new Array();
        for(var idx in eqdata) {
            var year = "";
            for(i = 6; i < 10; i++) {
                year = year+eqdata[idx].Date[i];
            }
            if(year == yearPlot) {
                //console.log(year);
                yearIndex.push(idx);
            }
        }

        //create bomb data
        var bombsnew = [];
        var len = yearIndex.length;
        for(var i = 0; i < len; i++) {
            var dateValue=eqdata[yearIndex[i]].Date;
            var date = dateValue[0] + dateValue[1] + "/" + dateValue[3] + dateValue[4] + "/";
            var depthValue = parseFloat(eqdata[yearIndex[i]].Depth);
            var colorfillKey;
            var fillOpacityValue;
            if (depthValue < 20) {;
                colorfillKey = 'C6';
                fillOpacityValue = 0.8;
            } else if (depthValue >= 20 && depthValue < 40) {
                colorfillKey = 'C5';
                fillOpacityValue = 0.7;
            } else if (depthValue >= 40 && depthValue < 60) {         
                colorfillKey = 'C4';
                fillOpacityValue = 0.6;
            } else if (depthValue >= 60 && depthValue < 100) {
                colorfillKey = 'C3';
                fillOpacityValue = 0.5;
            } else if (depthValue >= 100 && depthValue < 200) {
                colorfillKey = 'C2';
                fillOpacityValue = 0.5;
            } else{
                colorfillKey = 'C1';
                fillOpacityValue = 0.5;
            }

            bombsnew.push({
                name: date+yearPlot + "," +eqdata[yearIndex[i]].Time,
                magnitude: parseFloat(eqdata[yearIndex[i]].Magnitude),
                depth: parseFloat(eqdata[yearIndex[i]].Depth),
                radius: rScale(parseFloat(eqdata[yearIndex[i]].Magnitude)),
                fillKey: colorfillKey,
                fillOpacity: fillOpacityValue,
                latitude: parseFloat(eqdata[yearIndex[i]].Latitude),
                longitude: parseFloat(eqdata[yearIndex[i]].Longitude),
                borderWidth: 0,
                borderColor: '#FFFFFF'
            })
             // console.log(eqdata[i].Magnitude)
        }

        //render map only once.
        if(check == 1){
            bombMap = plotMap();
            check = 0;
        }
        
        
        //draw bubbles for bombs
        bombMap.bubbles(bombsnew, {

            popupTemplate: function (geo, data) {
                // Draw histogram 
                // Use dummy data now
                var dataPoints = "";
                createChart(dataPoints);
                    
                var magnitude = data.magnitude;
                drawEarthquake(magnitude);
                drawDepth(data); //still working on here
                
                return ['<div class="hoverinfo">' +  data.name,
                '<br/>Magnitude: ' +  data.magnitude + '',
                '<br/>Depth: ' +  data.depth + '',
                '</div>'].join('');
            }

        });

        function plotMap() {
            var Map = new Datamap({
            element: document.getElementById('container1'),
            scope: 'world',
            geographyConfig: {
                popupOnHover: false,
                highlightOnHover: false
            },
            fills: {
                'C1':'#C8DDFB',
                'C2':'#6496D9',
                'C3':'#2B58AD',
                'C4':'#2843DC',
                'C5':'#132FB0',
                'C6':'#0011A3',
                defaultFill: '#e3e5e0'
            },
            bubblesConfig: {
                highlightOnHover: true,
                highlightFillColor: '#FC8D59',
                highlightBorderColor: 'rgba(250, 15, 160, 0.2)',
                highlightBorderWidth: 2,
                highlightBorderOpacity: 1,
                highlightFillOpacity: 0.85,

            },
            data: {
                // 'RUS': {fillKey: 'RUS'},
                // 'USA': {fillKey: 'USA'}
            }
            });
            return Map;
        }
    }


  // var ggg = d3.select("div#container1").append("circle")
  //     .attr("cx", 200)
  //     .attr("cy", 200)
  //     .attr("r", 50)
  //     .style("fill", "black");

    
    var delayInMilliseconds = 6000; //1 second
    // d3.selectAll("svg.datamap").remove();

    setTimeout(function() {
        special();
        d3.selectAll(".datamap").remove();
     //your code to be executed after 1 second
        queue()
            .defer(d3.csv, "database.csv")
            .await(ready2);

        var check = 1; //check if the map has already been created. 
        var bombMap;
        special();

        function ready2(error, data) {
            special();
            var eqdata = data;
            // var yearPlot = "02/27/2010";
            //radius scale and color scale
            var rScale = d3.scale.linear()
                .domain([5, 9])
                .range([2, 40]);

            //get year of 1965, store index to yearIndex
            var yearIndex = new Array();

            yearIndex.push("17083","20501", "19928");
            // console.log(yearIndex);
            // console.log(eqdata[17083]);
            // console.log(eqdata[20501]);
            // console.log(eqdata[19928]);

            //create bomb data
            var bombsnew = [];
            var len = yearIndex.length;
            for(var i = 0; i < len; i++) {
                var dateValue=eqdata[yearIndex[i]].Date;
                var date = dateValue[0] + dateValue[1] + "/" + dateValue[3] + dateValue[4] + "/";
                var depthValue = parseFloat(eqdata[yearIndex[i]].Depth);
                var colorfillKey;
                var fillOpacityValue;
                if (depthValue < 20) {;
                    colorfillKey = 'C6';
                    fillOpacityValue = 1;
                } else if (depthValue >= 20 && depthValue < 40) {
                    colorfillKey = 'C5';
                    fillOpacityValue = 1;
                } else if (depthValue >= 40 && depthValue < 60) {         
                    colorfillKey = 'C4';
                    fillOpacityValue = 0;
                } else if (depthValue >= 60 && depthValue < 100) {
                    colorfillKey = 'C3';
                    fillOpacityValue = 0;
                } else if (depthValue >= 100 && depthValue < 200) {
                    colorfillKey = 'C2';
                    fillOpacityValue = 0;
                } else{
                    colorfillKey = 'C1';
                    fillOpacityValue = 0;
                }

                bombsnew.push({
                    name: date + "," +eqdata[yearIndex[i]].Time,
                    magnitude: parseFloat(eqdata[yearIndex[i]].Magnitude),
                    depth: parseFloat(eqdata[yearIndex[i]].Depth),
                    radius: rScale(parseFloat(eqdata[yearIndex[i]].Magnitude)),
                    fillKey: colorfillKey,
                    fillOpacity: fillOpacityValue,
                    latitude: parseFloat(eqdata[yearIndex[i]].Latitude),
                    longitude: parseFloat(eqdata[yearIndex[i]].Longitude),
                    borderWidth: 0,
                    borderColor: '#FFFFFF'
                })
                 // console.log(eqdata[i].Magnitude)
            }

            //render map only once.
            if(check == 1){
                bombMap = plotMap();
                check = 0;
            }
            
            
            //draw bubbles for bombs
            bombMap.bubbles(bombsnew, {

                popupTemplate: function (geo, data) {
                    // Draw histogram 
                    // Use dummy data now
                    var dataPoints = "";
                    createChart(dataPoints);

                    
                    return ['<div class="hoverinfo">' +  data.name,
                    '<br/>Magnitude: ' +  data.magnitude + '',
                    '<br/>Depth: ' +  data.depth + '',
                    '</div>'].join('');
                }

            });

            function plotMap() {
                var Map = new Datamap({
                element: document.getElementById('container1'),
                scope: 'world',
                geographyConfig: {
                    popupOnHover: false,
                    highlightOnHover: false
                },
                fills: {
                    'C1':'#C8DDFB',
                    'C2':'#6496D9',
                    'C3':'#2B58AD',
                    'C4':'#2843DC',
                    'C5':'#132FB0',
                    'C6':'#0011A3',
                    defaultFill: '#e3e5e0'
                },
                bubblesConfig: {
                    highlightOnHover: true,
                    highlightFillColor: '#FC8D59',
                    highlightBorderColor: 'rgba(250, 15, 160, 0.2)',
                    highlightBorderWidth: 2,
                    highlightBorderOpacity: 1,
                    highlightFillOpacity: 0.85,
                },
                // data: {
                //     // 'RUS': {fillKey: 'RUS'},
                //     // 'USA': {fillKey: 'USA'}
                // }
                });
                return Map;
            }
        }
    }, delayInMilliseconds);
    
    
    

// 
    
    
</script>
</body>
</html>